<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Carrusel Orbis - Ventanas Popup</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      margin: 0; 
      font-family: ui-sans-serif, system-ui, Arial, sans-serif;
      background: linear-gradient(135deg, #0b0f14, #1a2433);
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      text-align: center;
    }
    
    .launcher {
      background: rgba(255,255,255,0.05);
      padding: 40px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.1);
      backdrop-filter: blur(10px);
      max-width: 400px;
    }
    
    h1 {
      font-size: 24px;
      margin-bottom: 20px;
      color: #e5eefc;
    }
    
    .status {
      font-size: 16px;
      color: #93a3b8;
      margin-bottom: 15px;
    }
    
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,0.2);
      border-top: 3px solid #5fb3ff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-left: 10px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .note {
      background: rgba(91,179,255,0.1);
      border: 1px solid rgba(91,179,255,0.3);
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
      font-size: 14px;
      color: #93a3b8;
    }
  </style>
</head>
<body>
  <div class="launcher">
    <h1>üåü Carrusel Orbis</h1>
    <div class="status">Iniciando autom√°ticamente...</div>
    <div class="loading"></div>
    <div class="note">
      üí° <strong>Soluci√≥n Mixed Content:</strong><br>
      Usando ventanas popup para evitar restricciones HTTPS/HTTP en GitHub Pages
    </div>
  </div>

  <script>
    // Configuraci√≥n de p√°ginas - URLs originales (funcionan en popup)
    const PAGES = [
      {
        name: 'SAP Fiori Launchpad',
        url: 'http://confiablepro.serviacero.com/WS/01/37/WS01.37.09D.aspx'
      },
      {
        name: 'SAP GUI Web',  
        url: 'http://confiable.serviacero.com/RE/01/37/RE01.37-10.aspx'
      },
      {
        name: 'Web Intelligence',
        url: 'https://my407367.s4hana.cloud.sap/ui#PurchaseOrderItem-monitorPurDocItems&/?sap-iapp-state--history=TASP48AED8OZYI0BTH47XUTFQWYBJDV04UZ8QC90C&sap-iapp-state=ASJSAV5RWSMGIJ1I7NTPVW2SOUTF9H1TY7YZA2KN'
      },
      {
        name: 'Crystal Reports',
        url: 'https://my407367.s4hana.cloud.sap/ui#PurchaseOrderItem-monitorPurDocItems&/?sap-iapp-state--history=TASP48AED8OZYI0BTH47XUTFQWYBJDV04UZ8QC90C&sap-iapp-state=ASJSAV5RWSMGIJ1I7NTPVW2SOUTF9H1TY7YZA2KN'
      }
    ];

    // Variables del carrusel
    let currentWindow = null;
    let currentPageIndex = 0;
    let countdownTimer = null;
    let autoAdvanceTimer = null;
    let countdownValue = 60;

    // Iniciar autom√°ticamente
    document.addEventListener('DOMContentLoaded', function() {
      setTimeout(startCarousel, 2000);
    });

    function startCarousel() {
      openCurrentPage();
      setTimeout(startCountdown, 3000);
    }

    function openCurrentPage() {
      // Cerrar ventana anterior si existe
      if (currentWindow && !currentWindow.closed) {
        currentWindow.close();
      }

      const page = PAGES[currentPageIndex];
      console.log('üöÄ Abriendo:', page.name);
      
      // Abrir ventana en pantalla completa
      currentWindow = window.open(
        page.url,
        'carrusel_' + currentPageIndex,
        'width=' + screen.availWidth + ',height=' + screen.availHeight + ',left=0,top=0,fullscreen=yes,menubar=no,toolbar=no,location=no,status=no,scrollbars=yes,resizable=yes'
      );

      if (!currentWindow) {
        alert('‚ö†Ô∏è Por favor permite ventanas emergentes para que funcione el carrusel');
        return false;
      }

      // A√±adir controles flotantes despu√©s de que cargue
      setTimeout(addFloatingControls, 2000);
      return true;
    }

    function addFloatingControls() {
      if (!currentWindow || currentWindow.closed) return;

      try {
        // Crear controles flotantes
        const controlsHTML = `
          <div id="orbisControls" style="
            position: fixed; 
            top: 20px; 
            right: 20px; 
            z-index: 999999;
            background: rgba(0,0,0,0.9); 
            color: white; 
            padding: 15px; 
            border-radius: 10px; 
            font-family: Arial, sans-serif;
            border: 2px solid #5fb3ff;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
            min-width: 200px;
          ">
            <div style="text-align: center; margin-bottom: 10px;">
              <div style="color: #5fb3ff; font-weight: bold; margin-bottom: 5px;">
                P√°gina ${currentPageIndex + 1}/${PAGES.length}
              </div>
              <div style="font-size: 12px; color: #ccc;">
                ${PAGES[currentPageIndex].name}
              </div>
            </div>
            
            <div style="display: flex; gap: 8px; margin-bottom: 10px;">
              <button onclick="window.opener.goToPreviousPage()" style="
                flex: 1; padding: 8px; background: #6b7280; color: white; 
                border: none; border-radius: 5px; cursor: pointer; font-size: 12px;
              ">‚óÄ Anterior</button>
              
              <button onclick="window.opener.goToNextPage()" style="
                flex: 1; padding: 8px; background: #5fb3ff; color: #000; 
                border: none; border-radius: 5px; cursor: pointer; font-size: 12px; font-weight: bold;
              ">Siguiente ‚ñ∂</button>
            </div>
            
            <div style="text-align: center; margin-bottom: 10px;">
              <div id="orbisCountdown" style="
                background: rgba(255,255,255,0.1); 
                padding: 5px 10px; 
                border-radius: 5px; 
                font-size: 14px; 
                font-weight: bold;
                color: #f59e0b;
              ">60s</div>
            </div>
            
            <div style="display: flex; gap: 5px;">
              <button onclick="window.opener.togglePause()" style="
                flex: 1; padding: 6px; background: #f59e0b; color: white; 
                border: none; border-radius: 5px; cursor: pointer; font-size: 11px;
              ">‚è∏ Pausar</button>
              
              <button onclick="if(confirm('¬øCerrar carrusel?')) { window.opener.stopCarousel(); window.close(); }" style="
                flex: 1; padding: 6px; background: #ef4444; color: white; 
                border: none; border-radius: 5px; cursor: pointer; font-size: 11px;
              ">‚úï Cerrar</button>
            </div>
          </div>
        `;

        // Remover controles existentes
        const existing = currentWindow.document.getElementById('orbisControls');
        if (existing) existing.remove();

        // A√±adir nuevos controles
        const div = currentWindow.document.createElement('div');
        div.innerHTML = controlsHTML;
        currentWindow.document.body.appendChild(div.firstElementChild);

        console.log('‚úÖ Controles flotantes a√±adidos');
      } catch (e) {
        console.warn('‚ö†Ô∏è No se pudieron a√±adir controles (p√°gina de origen cruzado):', e.message);
      }
    }

    function updateFloatingCountdown(value) {
      if (!currentWindow || currentWindow.closed) return;

      try {
        const countdownElement = currentWindow.document.getElementById('orbisCountdown');
        if (countdownElement) {
          countdownElement.textContent = value + 's';
          
          // Cambiar color seg√∫n tiempo restante
          if (value <= 10) {
            countdownElement.style.color = '#ef4444';
            countdownElement.style.background = 'rgba(239,68,68,0.2)';
          } else if (value > 45) {
            countdownElement.style.color = '#22c55e';
            countdownElement.style.background = 'rgba(34,197,94,0.2)';
          } else {
            countdownElement.style.color = '#f59e0b';
            countdownElement.style.background = 'rgba(255,255,255,0.1)';
          }
        }
      } catch (e) {
        // Silently fail para p√°ginas cross-origin
      }
    }

    function goToNextPage() {
      currentPageIndex = (currentPageIndex + 1) % PAGES.length;
      openCurrentPage();
      resetCountdown();
    }

    function goToPreviousPage() {
      currentPageIndex = currentPageIndex === 0 ? PAGES.length - 1 : currentPageIndex - 1;
      openCurrentPage();
      resetCountdown();
    }

    function togglePause() {
      if (countdownTimer) {
        // Pausar
        clearInterval(countdownTimer);
        clearTimeout(autoAdvanceTimer);
        countdownTimer = null;
        console.log('‚è∏Ô∏è Carrusel pausado');
      } else {
        // Reanudar
        startCountdown();
        console.log('‚ñ∂Ô∏è Carrusel reanudado');
      }
    }

    function startCountdown() {
      if (countdownTimer) return; // Ya est√° corriendo

      countdownValue = 60;
      updateFloatingCountdown(countdownValue);

      // Timer del countdown
      countdownTimer = setInterval(function() {
        countdownValue--;
        updateFloatingCountdown(countdownValue);
        
        if (countdownValue <= 0) {
          goToNextPage();
        }
      }, 1000);

      // Timer de auto-avance
      autoAdvanceTimer = setTimeout(function() {
        goToNextPage();
      }, 60000);
    }

    function resetCountdown() {
      clearInterval(countdownTimer);
      clearTimeout(autoAdvanceTimer);
      countdownTimer = null;
      setTimeout(startCountdown, 3000);
    }

    function stopCarousel() {
      clearInterval(countdownTimer);
      clearTimeout(autoAdvanceTimer);
      if (currentWindow && !currentWindow.closed) {
        currentWindow.close();
      }
      console.log('üõë Carrusel detenido');
    }

    // Limpiar al cerrar la ventana principal
    window.addEventListener('beforeunload', stopCarousel);
  </script>
</body>
</html>
